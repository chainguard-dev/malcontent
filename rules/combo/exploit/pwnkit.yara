rule polkit_pkexec_exploit: critical {
  meta:
    description = "polkit pkexec exploit (CVE-2021-4034)"

  strings:
    $ref  = "PATH" fullword
    $ref2 = "pkexec"
    $ref3 = "reverse_shell"

    $pwnkit  = "PwnKit"
    $pwnkit2 = "pwnkit"
    $pwn_cve = "cve-2021-4034"
    $pwn_CVE = "CVE-2021-4034"

  condition:
    any of ($pwn*) and any of ($ref*)
}

rule polkit_pkexec_exploit2: critical {
  meta:
    description = "polkit pkexec exploit (CVE-2021-4034)"

  strings:
    $ref  = "GCONV_PATH=."
    $ref2 = "CMDTOEXECUTE"
    $ref3 = "NOTTY_PORT"
    $ref4 = "payload.so"
    $ref5 = "pkexec"
    $ref6 = "main.gconv_init"

  condition:
    4 of them
}
