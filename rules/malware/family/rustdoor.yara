rule rustdoor: critical macos {
  meta:
    description = "Rustdoor"
    ref         = "https://medium.com/s2wblog/rustdoor-and-gatedoor-a-new-pair-of-weapons-disguised-as-legitimate-software-by-suspected-34c94e558b40"
    filetypes   = "macho"
    hash        = "20b986b24d86d9a06746bdb0c25e21a24cb477acb36e7427a8c465c08d51c1e4"

  strings:
    $botkill      = { 62 6F 74 6B 69 6C 6C }  // suppress: text_as_hex
    $dialog       = { 7A 69 70 74 61 73 6B }  // suppress: text_as_hex
    $upload       = { 75 70 6C 6F 61 64 5F 66 69 6C 65 73 72 63 }  // suppress: text_as_hex
    $launchagents = { 4C 61 75 6E 63 68 41 67 65 6E 74 73 2E 70 6C 69 73 74 }  // suppress: text_as_hex

  condition:
    filesize > 1MB and filesize < 10MB and all of them
}

rule rustdoor_v2: critical macos {
  meta:
    description = "Rustdoor v2"
    ref         = "https://medium.com/s2wblog/rustdoor-and-gatedoor-a-new-pair-of-weapons-disguised-as-legitimate-software-by-suspected-34c94e558b40"
    filetypes   = "macho"

  strings:
    $cfg_daemonize      = { 64 61 65 6D 6F 6E 69 7A 65 }  // suppress: text_as_hex
    $cfg_cron           = { 63 68 65 63 6B 5F 63 72 6F 6E 5F 61 73 6B 65 64 }  // suppress: text_as_hex
    $cfg_lock_in_cron   = { 6C 6F 63 6B 5F 69 6E 5F 63 72 6F 6E }  // suppress: text_as_hex
    $cfg_lock_in_dock   = { 6C 6F 63 6B 5F 69 6E 5F 64 6F 63 6B }  // suppress: text_as_hex
    $cfg_lock_in_launch = { 6C 6F 63 6B 5F 69 6E 5F 6C 61 75 6E 63 68 }  // suppress: text_as_hex
    $cfg_copy_files     = { 63 6F 70 79 5F 66 69 6C 65 73 }  // suppress: text_as_hex

  condition:
    filesize > 1MB and filesize < 10MB and 4 of them
}

rule rustdoor_maybe: high {
  meta:
    description = "Possibly Rustdoor"
    ref         = "https://medium.com/s2wblog/rustdoor-and-gatedoor-a-new-pair-of-weapons-disguised-as-legitimate-software-by-suspected-34c94e558b40"
    filetypes   = "macho"

  strings:
    $botkill = { 62 6F 74 6B 69 6C 6C }  // suppress: text_as_hex
    $upload  = { 75 70 6C 6F 61 64 }  // suppress: text_as_hex
    $sleep   = { 73 6C 65 65 70 }  // suppress: text_as_hex
    $rmdir   = { 72 6D 64 69 72 }  // suppress: text_as_hex

  condition:
    filesize > 1MB and filesize < 10MB and all of them
}
