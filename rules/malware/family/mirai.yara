rule mirai: critical linux {
  meta:
    description = "Mirai"
    filetypes   = "elf"
    ref         = "https://www.cloudflare.com/learning/ddos/glossary/mirai-botnet/"

  strings:
    $ = "/proc/%d"
    $ = "/proc/cpuinfo"
    $ = "/proc/self/fd"
    $ = "/proc/stat"
    $ = "Connection closed by the peer."
    $ = "GCC: (GNU) 4"
    $ = "Received %zd bytes: %s"
    $ = "Received Buffer:"
    $ = "_READ.c"
    $ = "_WRITE.c"
    $ = "__scan_cookie.c"
    $ = "been_there_done_that"
    $ = "connectToCNC"

  condition:
    uint32(0) == 1179403647 and filesize > 40KB and filesize < 100KB and 80 % of them
}

rule mirai2: critical linux {
  meta:
    description = "Mirai"
    filetypes   = "elf"
    ref         = "https://www.cloudflare.com/learning/ddos/glossary/mirai-botnet/"

  strings:
    $ = "Failed to set IP_HDRINCL"
    $ = "/dev/null"
    $ = "Not a XENIX named type file"
    $ = "(null)"
    $ = "/proc/net/tcp"
    $ = "Success" fullword
    $ = ".lib section in a.out corrupted"
    $ = "hlLjztqZ"
    $ = "npxXoudifFeEgGaACScs"
    $ = "RFS specific error"

  condition:
    uint32(0) == 1179403647 and filesize > 40KB and filesize < 100KB and 75 % of them
}

rule mirai_helper: critical linux {
  meta:
    description = "Mirai DVR helper"
    filetypes   = "elf"
    ref         = "https://www.cloudflare.com/learning/ddos/glossary/mirai-botnet/"

  strings:
    $ = "MIRAI"
    $ = "dvrHelper"
    $ = "HTTP/1.0"

  condition:
    uint32(0) == 1179403647 and filesize < 20KB and all of them
}
