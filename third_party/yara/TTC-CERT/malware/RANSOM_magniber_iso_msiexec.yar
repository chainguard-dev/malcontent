rule iso_magniber_ransomware {
   meta:
      version = "1.0"
      first_imported = "2023-01-18"
      last_modified = "2023-01-19"
      status = "RELEASED"
      sharing = "TLP:CLEAR"
      source = "Manual investigate"
      author = "TTC-CERT"
      description = "Magniber ransomware infects Windows users via iso file and uses a Windows installer package file (.msi) for its distribution"
      category = "TECHNIQUE"
      technique = "SYSTEM BINARY PROXY EXECUTION:MSIEXEC"
      mitre_att = "T1218.007"
      hash = "4dcbcc070e7e3d0696c777b63e185406e3042de835b734fe7bb33cc12e539bf6"
   strings:
      $x1 = "C:\\Windows\\System32\\msiexec.exe" fullword wide
      $s1 = "UpdatesHandler.dll" fullword ascii
      $s2 = "Windows installer package for A1 5G Desktop Application" ascii
      $s3 = "/i" fullword wide
      $s4 = "/qn" fullword wide
      $s5 = "security update for Windows 10 for x64-based Systems (KB5023921)" ascii
      $s6 = "Installer" ascii
      $s7 = "msitools" ascii
   condition:
      (uint32(32769) == 0x30304443 or uint32(34817) == 0x30304443 or uint32(36865) == 0x30304443)
      and filesize < 1000KB
      and 1 of ($x*) and 4 of ($s*)
}
